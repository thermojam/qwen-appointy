generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String         @id @default(uuid())
  email         String         @unique
  phone         String?        @unique
  password      String
  role          UserRole       @default(CLIENT)
  status        AccountStatus  @default(PENDING)
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  client        Client?
  master        Master?
  notifications Notification[]
  refreshTokens RefreshToken[]

  @@index([email])
  @@index([role])
}

model RefreshToken {
  id        String   @id @default(uuid())
  token     String   @unique
  userId    String
  expiresAt DateTime
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([token])
}

model Master {
  id                          String           @id @default(uuid())
  userId                      String           @unique
  avatarUrl                   String?
  fullName                    String
  description                 String?
  workFormat                  WorkFormat       @default(BOTH)
  offlineMode                 OfflineMode?
  address                     String?
  latitude                    Float?
  longitude                   Float?
  experienceYears             Int              @default(0)
  rating                      Float            @default(0)
  totalReviews                Int              @default(0)
  bookingConfirmationRequired Boolean          @default(true)
  minCancellationTime         Int              @default(24)
  maxBookingLeadTime          Int              @default(30)
  isVerified                  Boolean          @default(false)
  isActive                    Boolean          @default(true)
  createdAt                   DateTime         @default(now())
  updatedAt                   DateTime         @updatedAt
  appointments                Appointment[]    @relation("MasterAppointments")
  favorites                   FavoriteMaster[]
  user                        User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  portfolio                   PortfolioWork[]
  reviews                     Review[]
  schedule                    Schedule[]
  services                    Service[]

  @@index([userId])
  @@index([workFormat])
  @@index([rating])
  @@index([isActive])
}

model Client {
  id           String           @id @default(uuid())
  userId       String           @unique
  avatarUrl    String?
  fullName     String
  interests    String[]
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt
  appointments Appointment[]    @relation("ClientAppointments")
  user         User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  favorites    FavoriteMaster[]
  reviews      Review[]

  @@index([userId])
}

model Service {
  id           String        @id @default(uuid())
  masterId     String
  name         String
  description  String?
  duration     Int
  price        Decimal       @db.Decimal(10, 2)
  isActive     Boolean       @default(true)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  appointments Appointment[]
  master       Master        @relation(fields: [masterId], references: [id], onDelete: Cascade)

  @@index([masterId])
  @@index([isActive])
}

model Schedule {
  id         String   @id @default(uuid())
  masterId   String
  date       DateTime
  startTime  String
  endTime    String
  breakStart String?
  breakEnd   String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  master     Master   @relation(fields: [masterId], references: [id], onDelete: Cascade)

  @@unique([masterId, date])
  @@index([masterId])
  @@index([date])
}

model Appointment {
  id        String            @id @default(uuid())
  masterId  String
  clientId  String
  serviceId String
  dateTime  DateTime
  status    AppointmentStatus @default(PENDING)
  comment   String?
  createdAt DateTime          @default(now())
  updatedAt DateTime          @updatedAt
  client    Client            @relation("ClientAppointments", fields: [clientId], references: [id])
  master    Master            @relation("MasterAppointments", fields: [masterId], references: [id])
  service   Service           @relation(fields: [serviceId], references: [id])

  @@index([masterId])
  @@index([clientId])
  @@index([dateTime])
  @@index([status])
}

model Review {
  id        String   @id @default(uuid())
  masterId  String
  clientId  String
  rating    Int
  comment   String?
  createdAt DateTime @default(now())
  client    Client   @relation(fields: [clientId], references: [id], onDelete: Cascade)
  master    Master   @relation(fields: [masterId], references: [id], onDelete: Cascade)

  @@unique([masterId, clientId])
  @@index([masterId])
  @@index([rating])
}

model FavoriteMaster {
  id        String   @id @default(uuid())
  masterId  String
  clientId  String
  createdAt DateTime @default(now())
  client    Client   @relation(fields: [clientId], references: [id], onDelete: Cascade)
  master    Master   @relation(fields: [masterId], references: [id], onDelete: Cascade)

  @@unique([masterId, clientId])
  @@index([masterId])
  @@index([clientId])
}

model PortfolioWork {
  id          String   @id @default(uuid())
  masterId    String
  imageUrl    String
  title       String?
  description String?
  createdAt   DateTime @default(now())
  master      Master   @relation(fields: [masterId], references: [id], onDelete: Cascade)

  @@index([masterId])
}

model Notification {
  id        String           @id @default(uuid())
  userId    String
  type      NotificationType
  title     String
  message   String
  isRead    Boolean          @default(false)
  createdAt DateTime         @default(now())
  user      User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([isRead])
  @@index([type])
}

enum UserRole {
  MASTER
  CLIENT
  ADMIN
}

enum AccountStatus {
  PENDING
  ACTIVE
  SUSPENDED
  DELETED
}

enum WorkFormat {
  ONLINE
  OFFLINE
  BOTH
}

enum OfflineMode {
  AT_MY_PLACE
  AT_CLIENT_PLACE
}

enum AppointmentStatus {
  PENDING
  CONFIRMED
  COMPLETED
  CANCELLED
  NO_SHOW
}

enum NotificationType {
  APPOINTMENT_CREATED
  APPOINTMENT_CONFIRMED
  APPOINTMENT_CANCELLED
  APPOINTMENT_REMINDER
  REVIEW_RECEIVED
  SYSTEM
}
